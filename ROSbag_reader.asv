bSel = select(bag, 'Topic', '/hive_0/xy_1/queen_position');
msgs = readMessages(bSel, 'DataFormat', 'struct');

N = numel(msgs);
queen_data = nan(N,3); % [X Y Phi]

for i = 1:N
    if ~isempty(msgs{i}.Positions)
        queen_data(i,1) = msgs{i}.Positions(1).X;
        queen_data(i,2) = msgs{i}.Positions(1).Y;
        queen_data(i,3) = msgs{i}.Positions(1).Phi;
    end
end

queen_data(any(isnan(queen_data),2),:) = [];


% % 6. Display or use the data
% disp('First 5 rows of Queen Data (X, Y, Phi):');
% disp(queen_data(1:5, :));
% 
% % Optional: Plot the path
% figure;
% plot(queen_data(:,1), queen_data(:,2));
% title('Queen Position (X vs Y)');
% xlabel('X'); ylabel('Y');
% axis equal;